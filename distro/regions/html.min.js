/*!
The HTML region utilizes the full HTML5 ContentEditable featureset and adds some layers on top of that to normalize it
between browsers and to make it nicer to use.

Dependencies:
  rangy-core - https://code.google.com/p/rangy/
  rangy-serializer
  rangy-cssclassapplier
*/
(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Mercury.HtmlRegion=function(e){function n(){try{window.rangy.init()}catch(e){return this.notify(this.t("requires Rangy")),!1}n.__super__.constructor.apply(this,arguments)}return t(n,e),n.define("Mercury.HtmlRegion","html"),n.include(Mercury.Region.Modules.DropIndicator),n.include(Mercury.Region.Modules.HtmlSelection),n.include(Mercury.Region.Modules.SelectionValue),n.include(Mercury.Region.Modules.ContentEditable),n.supported=document.designMode&&(!Mercury.support.msie||Mercury.support.msie>=10)&&window.rangy&&window.rangy.supported,n.prototype.events={keydown:"onKeyEvent",paste:"onPaste"},n.prototype.onDropFile=function(e,t){var n,r=this;return n=new Mercury.Uploader(e,{mimeTypes:this.config("regions:html:mimeTypes")}),n.on("uploaded",function(e){return r.focus(),r.handleAction("file",e)})},n.prototype.onDropItem=function(){return this.pushHistory()},n.prototype.onPaste=function(e){return console.debug("pasted",e)},n.prototype.onKeyEvent=function(e){if(e.keyCode>=37&&e.keyCode<=40)return;if(e.metaKey&&e.keyCode===90)return;if(e.metaKey)switch(e.keyCode){case 66:return e.preventDefault(),this.handleAction("bold");case 73:return e.preventDefault(),this.handleAction("italic");case 85:return e.preventDefault(),this.handleAction("underline")}return this.pushHistory(e.keyCode)},n.prototype.actions={bold:function(){return this.toggleWrapSelectedWordsInClass("red")},italic:function(){return this.toggleWrapSelectedWordsInClass("highlight")},underline:function(){return this.toggleWrapSelectedWordsInClass("blue")},rule:function(){return this.replaceSelection("<hr/>")},file:function(e){var t;return t=e.isImage()?"image":"link",this.handleAction(t,e.get("url"),e.get("name"))},image:function(e,t,n){var r;return n==null&&(n={}),r=$("<img>",$.extend({src:e,alt:t},n)),this.replaceSelection(r,{text:t})}},n}(Mercury.Region)}).call(this);