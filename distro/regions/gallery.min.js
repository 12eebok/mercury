(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Mercury.GalleryRegion=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.supported=!0,n.define("Mercury.GalleryRegion","gallery",{undo:"undo",redo:"redo"}),n.prototype.className="mercury-gallery-region",n.prototype.elements={controls:".mercury-gallery-region-controls",slides:".slides",paginator:".paginator"},n.prototype.events={"click .mercury-gallery-region-controls em":"removeSlide","click .mercury-gallery-region-controls img":"gotoSlide"},n.prototype.build=function(){var e=this;return this.speed||(this.speed=3e3),this.append('<ul class="mercury-gallery-region-controls"></ul>'),this.index=1,this.refresh(!0),this.delay(this.speed,function(){return e.nextSlide()}),this.pushStack(this.el.html())},n.prototype.onBlur=function(){return this.controls.hide()},n.prototype.onFocus=function(){return this.controls.show()},n.prototype.undo=function(){var e;return(e=this.undoStack())&&this.html(e),this.refresh(!0)},n.prototype.redo=function(){var e;return(e=this.redoStack())&&this.html(e),this.refresh(!0)},n.prototype.refresh=function(e){e==null&&(e=!1),this.images=this.$(".slide").hide(),this.index>this.images.length&&(this.index=1),this.$(".slide:nth-child("+this.index+")").show(),this.paginator.html(Array(this.images.length+1).join("<span>&bull;</span>")),this.paginator.find("span:nth-child("+this.index+")").addClass("active");if(e)return this.refreshControls()},n.prototype.refreshControls=function(){var e,t,n,r,i;this.controls.html(""),r=this.images,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.addLink($(e)));return i},n.prototype.nextSlide=function(){var e=this;return this.index+=1,this.refresh(),this.timeout=this.delay(this.speed,function(){return e.nextSlide()})},n.prototype.gotoSlide=function(e){var t=this;return clearTimeout(this.timeout),this.index=$(e.target).closest("li").prevAll("li").length+1,this.refresh(),this.timeout=this.delay(this.speed,function(){return t.nextSlide()})},n.prototype.addLink=function(e){var t;return t=e.find("img").attr("src"),this.controls.append($('<li><img src="'+t+'"/><em>&times;</em></li>').data({slide:e}))},n.prototype.dropFile=function(e){var t,n=this;return t=new Mercury.Uploader(e,{mimeTypes:this.config("regions:gallery:mimeTypes")}),t.on("uploaded",function(){return n.appendSlide.apply(n,arguments)})},n.prototype.appendSlide=function(e){var t;if(!e.isImage())return;return t=$('<div class="slide"><img src="'+e.get("url")+'"/></div>'),this.slides.append(t),this.addLink(t),this.refresh(),this.pushStack(this.el.html())},n.prototype.removeSlide=function(e){var t,n,r,i=this;return t=$(e.target).closest("li"),r=t.data("slide"),n=r.prevAll(".slide").length+1,r.remove(),t.remove(),n<this.index?this.index-=1:n===this.index&&(clearTimeout(this.timeout),this.timeout=this.delay(this.speed,function(){return i.nextSlide()})),this.refresh(),this.pushStack(this.el.html())},n}(Mercury.Region)}).call(this);